<div class="workouts-shell">
  <div class="container py-4 py-md-5">
    <section class="hero-panel mb-4 mb-md-5">
      <div class="d-flex flex-column flex-xl-row justify-content-between align-items-xl-center gap-3">
        <div>
          <p class="section-kicker mb-2">{{ 'workouts.kicker' | t }}</p>
          <h1 class="display-4 fw-bold mb-2">{{ 'workouts.title' | t }}</h1>
          <p class="lead mb-0">{{ 'workouts.subtitle' | t }}</p>

          <div class="filter-strip mt-3">
            <div class="filter-container">
              <div class="filter-label">{{ 'common.timeRange' | t }}</div>
              <div class="filter-buttons">
                <button
                  *ngFor="let option of filterOptions"
                  type="button"
                  class="filter-btn"
                  [class.active]="selectedFilter === option.days"
                  (click)="onFilterChange(option.days)">
                  {{ option.label }}
                </button>
              </div>
            </div>
          </div>
        </div>

        <button class="btn btn-primary btn-lg" (click)="openCreateModal()" [disabled]="loading">
          <i class="bi bi-plus-circle me-2"></i>{{ 'workouts.new' | t }}
        </button>
      </div>

    </section>

    <section *ngIf="error" class="mb-4">
      <div class="alert alert-danger d-flex justify-content-between align-items-center" role="alert">
        <span><i class="bi bi-exclamation-triangle me-2"></i>{{ error }}</span>
        <button type="button" class="btn btn-sm btn-outline-danger" (click)="error = null">{{ 'common.dismiss' | t }}</button>
      </div>
    </section>

    <section *ngIf="loading && workouts.length === 0" class="loading-panel text-center py-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">{{ 'common.loading' | t }}</span>
      </div>
      <p class="mt-3 mb-0">{{ 'workouts.loading' | t }}</p>
    </section>

    <section class="row g-4" *ngIf="!loading || workouts.length > 0">
      <div class="col-12" *ngIf="workouts.length === 0 && !loading">
        <div class="card empty-state-card">
          <div class="card-body text-center py-5">
            <i class="bi bi-clipboard-data display-1 text-muted mb-3"></i>
            <h3 class="mb-3">{{ 'workouts.empty.title' | t }}</h3>
            <p class="text-muted mb-4" *ngIf="selectedFilter === 0">{{ 'workouts.empty.all' | t }}</p>
            <p class="text-muted mb-4" *ngIf="selectedFilter !== 0">{{ 'workouts.empty.filtered' | t }}</p>
            <button class="btn btn-primary btn-lg" (click)="openCreateModal()">
              <i class="bi bi-plus-circle me-2"></i>{{ 'workouts.empty.create' | t }}
            </button>
          </div>
        </div>
      </div>

      <div class="col-md-6 col-lg-4" *ngFor="let workout of workouts">
        <div class="card workout-card h-100" (click)="openWorkout(workout.id)">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start mb-3">
              <h5 class="card-title mb-0">{{ workout.title }}</h5>
              <button
                class="btn btn-sm btn-outline-danger delete-btn"
                (click)="deleteWorkout(workout.id, $event)"
                title="Delete workout">
                <i class="bi bi-trash"></i>
              </button>
            </div>
            <p class="text-muted mb-0">
              <i class="bi bi-calendar3 me-2"></i>{{ formatDate(workout.date) }}
            </p>
          </div>
          <div class="card-footer">
            <div class="d-flex justify-content-between align-items-center">
              <small class="text-muted">
                <i class="bi bi-arrow-right-circle me-1"></i>{{ 'workouts.card.view' | t }}
              </small>
              <button
                class="btn btn-sm btn-outline-primary copy-btn"
                (click)="copyWorkout(workout.id, $event)"
                title="Copy workout">
                <i class="bi bi-files me-1"></i>{{ 'workouts.copy' | t }}
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="row mt-5" *ngIf="getTotalPages() > 1">
      <div class="col-12">
        <nav aria-label="Page navigation">
          <ul class="pagination justify-content-center mb-2">
            <li class="page-item" [class.disabled]="currentPage === 1">
              <button class="page-link" (click)="previousPage()" [disabled]="currentPage === 1">
                <i class="bi bi-chevron-left me-1"></i>{{ 'pagination.prev' | t }}
              </button>
            </li>

            <li class="page-item" *ngFor="let page of [].constructor(getTotalPages()); let i = index" [class.active]="currentPage === (i + 1)">
              <button class="page-link" (click)="goToPage(i + 1)" [disabled]="currentPage === (i + 1)">
                {{ i + 1 }}
              </button>
            </li>

            <li class="page-item" [class.disabled]="currentPage === getTotalPages()">
              <button class="page-link" (click)="nextPage()" [disabled]="currentPage === getTotalPages()">
                {{ 'pagination.next' | t }}<i class="bi bi-chevron-right ms-1"></i>
              </button>
            </li>
          </ul>
        </nav>
        <div class="text-center page-meta">
          <small>{{ 'pagination.meta' | t:{ current: currentPage, total: getTotalPages(), count: totalWorkouts } }}</small>
        </div>
      </div>
    </section>
  </div>
</div>

<div class="modal fade" [class.show]="showCreateModal" [style.display]="showCreateModal ? 'block' : 'none'" tabindex="-1" *ngIf="showCreateModal">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{ 'workouts.create.title' | t }}</h5>
        <button type="button" class="btn-close" (click)="closeCreateModal()" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="createWorkout()">
          <div class="mb-3">
            <label for="workoutTitle" class="form-label">{{ 'workouts.field.title' | t }}</label>
            <input
              type="text"
              class="form-control"
              id="workoutTitle"
              [(ngModel)]="newWorkoutTitle"
              name="workoutTitle"
              [placeholder]="'workouts.field.title.placeholder' | t"
              required>
          </div>
          <div class="mb-3">
            <label for="workoutDate" class="form-label">{{ 'common.date' | t }}</label>
            <input
              type="date"
              class="form-control"
              id="workoutDate"
              [(ngModel)]="newWorkoutDate"
              name="workoutDate"
              required>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeCreateModal()">{{ 'common.cancel' | t }}</button>
        <button type="button" class="btn btn-primary" (click)="createWorkout()" [disabled]="!newWorkoutTitle.trim() || loading">
          <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
          {{ 'workouts.create.action' | t }}
        </button>
      </div>
    </div>
  </div>
</div>

<div class="modal-backdrop fade" [class.show]="showCreateModal" *ngIf="showCreateModal" (click)="closeCreateModal()"></div>

<app-confirm-delete
  [isOpen]="showDeleteConfirm"
  [title]="'workouts.delete.title' | t"
  [message]="'workouts.delete.message' | t"
  [itemName]="deleteWorkoutTitle || ''"
  [isLoading]="loading"
  (confirm)="onDeleteConfirm()"
  (cancel)="onDeleteCancel()">
</app-confirm-delete>
